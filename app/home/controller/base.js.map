{
    "version": 3,
    "sources": [
        "../../../src/home/controller/base.js"
    ],
    "names": [
        "init",
        "http",
        "HOME_VIEW_PATH",
        "think",
        "ROOT_PATH",
        "sep",
        "__before",
        "action",
        "firekylin",
        "isInstalled",
        "redirect",
        "model",
        "getOptions",
        "options",
        "navigation",
        "themeConfig",
        "JSON",
        "parse",
        "e",
        "assign",
        "version",
        "theme",
        "THEME_VIEW_PATH",
        "siteUrl",
        "site_url",
        "host",
        "getCateArchive",
        "categories",
        "tagModel",
        "getTagArchive",
        "tagList",
        "postModel",
        "getLastPostList",
        "lastPostList",
        "Date",
        "getFullYear",
        "displayView",
        "name",
        "url",
        "match",
        "jsonOutput",
        "assignObj",
        "forEach",
        "key",
        "indexOf",
        "type",
        "end",
        "display",
        "controller",
        "base"
    ],
    "mappings": "AAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;AACA;;;;;;;;;;;;;;AAGE;;;;;mBAKAA,I,iBAAKC,I,EAAM;AACT,oCAAMD,IAAN,YAAWC,IAAX;AACA;AACA,SAAKC,cAAL,QAAyBC,MAAMC,SAA/B,GAA2CD,MAAME,GAAjD,YAA2DF,MAAME,GAAjE,YAA2EF,MAAME,GAAjF;AACD,G;AACD;;;;;mBAGMC,Q;;;;;;;oBACD,KAAKL,IAAL,CAAUM,MAAV,KAAqB,S;;;;;;;;kBAGpBC,UAAUC,W;;;;;+CACL,KAAKC,QAAL,CAAc,gBAAd,C;;;AAGLC,mB,GAAQ,KAAKA,KAAL,CAAW,SAAX,C;;qBACQA,MAAMC,UAAN,E;;;AAAhBC,qB;;AACJ,mBAAKA,OAAL,GAAeA,OAAf;AACKC,wB,GAA2BD,O,CAA3BC,U,EAAYC,W,GAAeF,O,CAAfE,W;;AACjB,kBAAI;AACFD,6BAAaE,KAAKC,KAAL,CAAWH,UAAX,CAAb;AACD,eAFD,CAEE,OAAMI,CAAN,EAAS;AACTJ,6BAAa,EAAb;AACD;AACD,kBAAI;AACFC,8BAAcC,KAAKC,KAAL,CAAWF,WAAX,CAAd;AACD,eAFD,CAEE,OAAMG,CAAN,EAAS;AACTH,8BAAc,EAAd;AACD;;AAED,mBAAKI,MAAL,CAAY,SAAZ,EAAuBN,OAAvB;AACA,mBAAKM,MAAL,CAAY,YAAZ,EAA0BL,UAA1B;AACA,mBAAKK,MAAL,CAAY,aAAZ,EAA2BJ,WAA3B;AACA,mBAAKI,MAAL,CAAY,SAAZ,EAAuB,kBAAKC,OAA5B;AACA;AACIC,mB,GAAQR,QAAQQ,KAAR,IAAiB,W;;AAC7B,mBAAKC,eAAL,QAA0BnB,MAAMC,SAAhC,GAA4CD,MAAME,GAAlD,WAA2DF,MAAME,GAAjE,aAA4EF,MAAME,GAAlF,GAAwFgB,KAAxF,GAAgGlB,MAAME,GAAtG;;AAEA;AACIkB,qB,GAAU,KAAKV,OAAL,CAAaW,Q;;AAC3B,kBAAG,CAACD,OAAJ,EAAa;AACXA,0BAAU,YAAY,KAAKtB,IAAL,CAAUwB,IAAhC;AACD;AACD,mBAAKN,MAAL,CAAY,UAAZ,EAAwBI,OAAxB;;AAEA;;qBACuB,KAAKZ,KAAL,CAAW,MAAX,EAAmBe,cAAnB,E;;;AAAnBC,wB;;AACJ,mBAAKR,MAAL,CAAY,YAAZ,EAA0BQ,UAA1B;;AAEA;AACIC,sB,GAAW,KAAKjB,KAAL,CAAW,KAAX,C;;qBACKiB,SAASC,aAAT,E;;;AAAhBC,qB;;AACJ,mBAAKX,MAAL,CAAY,MAAZ,EAAoBW,OAApB;;AAEA;AACIC,uB,GAAY,KAAKpB,KAAL,CAAW,MAAX,C;;qBACSoB,UAAUC,eAAV,E;;;AAArBC,0B;;AACJ,mBAAKd,MAAL,CAAY,cAAZ,EAA4Bc,YAA5B;;AAEA,mBAAKd,MAAL,CAAY,aAAZ,EAA4B,IAAIe,IAAJ,EAAD,CAAaC,WAAb,EAA3B;;;;;;;;;;;;;;;;AAEF;;;;;;;mBAKMC,W;6FAAYC,I;;;;;;mBACZ,KAAKpC,IAAL,CAAUqC,GAAV,CAAcC,KAAd,CAAoB,gBAApB,C;;;;;AACEC,wB,GAAa,E,EACfC,S,GAAY,KAAKtB,MAAL,E;;AACd,kCAAYsB,SAAZ,EAAuBC,OAAvB,CAA+B,UAACC,GAAD,EAAO;AACpC,oBAAI,CAAC,YAAD,EAAe,MAAf,EAAuB,QAAvB,EAAiC,GAAjC,EAAsC,SAAtC,EAAiDC,OAAjD,CAAyDD,GAAzD,MAAkE,CAAC,CAAvE,EAA0E;AACxEH,6BAAWG,GAAX,IAAkBF,UAAUE,GAAV,CAAlB;AACD;AACF,eAJD;;AAMA,mBAAKE,IAAL,CAAU,kBAAV;gDACO,KAAKC,GAAL,CAASN,UAAT,C;;;gDAGF,KAAKO,OAAL,CAAa,KAAKzB,eAAL,GAAuBe,IAAvB,GAA8B,OAA3C,C;;;;;;;;;;;;;;;;;;EAvFkBlC,MAAM6C,UAAN,CAAiBC,I",
    "file": "../../../src/home/controller/base.js",
    "sourcesContent": [
        "'use strict';\nimport pack from '../../../package.json';\n\nexport default class extends think.controller.base {\n  /**\n   * init\n   * @param  {[type]} http [description]\n   * @return {[type]}      [description]\n   */\n  init(http) {\n    super.init(http);\n    //home view path\n    this.HOME_VIEW_PATH = `${think.ROOT_PATH}${think.sep}view${think.sep}home${think.sep}`;\n  }\n  /**\n   * some base method in here\n   */\n  async __before() {\n    if(this.http.action === 'install') {\n      return;\n    }\n    if(!firekylin.isInstalled) {\n      return this.redirect('/index/install');\n    }\n\n    let model = this.model('options');\n    let options = await model.getOptions();\n    this.options = options;\n    let {navigation, themeConfig} = options;\n    try {\n      navigation = JSON.parse(navigation);\n    } catch(e) {\n      navigation = [];\n    }\n    try {\n      themeConfig = JSON.parse(themeConfig);\n    } catch(e) {\n      themeConfig = {};\n    }\n\n    this.assign('options', options);\n    this.assign('navigation', navigation);\n    this.assign('themeConfig', themeConfig);\n    this.assign('VERSION', pack.version);\n    //set theme view root path\n    let theme = options.theme || 'firekylin';\n    this.THEME_VIEW_PATH = `${think.ROOT_PATH}${think.sep}www${think.sep}theme${think.sep}${theme}${think.sep}`;\n\n    //网站地址\n    let siteUrl = this.options.site_url;\n    if(!siteUrl) {\n      siteUrl = 'http://' + this.http.host;\n    }\n    this.assign('site_url', siteUrl);\n\n    //所有的分类\n    let categories = await this.model('cate').getCateArchive();\n    this.assign('categories', categories);\n\n    // 所有标签\n    let tagModel = this.model('tag');\n    let tagList = await tagModel.getTagArchive();\n    this.assign('tags', tagList);\n\n    // 最近10条文章\n    let postModel = this.model('post');\n    let lastPostList = await postModel.getLastPostList();\n    this.assign('lastPostList', lastPostList);\n\n    this.assign('currentYear', (new Date()).getFullYear());\n  }\n  /**\n   * display view page\n   * @param  {} name []\n   * @return {}      []\n   */\n  async displayView(name) {\n    if (this.http.url.match(/\\.json(?:\\?|$)/)) {\n      let jsonOutput = {},\n        assignObj = this.assign();\n      Object.keys(assignObj).forEach((key)=>{\n        if (['controller', 'http', 'config', '_', 'options'].indexOf(key) === -1) {\n          jsonOutput[key] = assignObj[key];\n        }\n      })\n\n      this.type('application/json');\n      return this.end(jsonOutput);\n    }\n\n    return this.display(this.THEME_VIEW_PATH + name + '.html');\n  }\n}\n"
    ]
}