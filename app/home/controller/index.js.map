{
    "version": 3,
    "sources": [
        "../../../src/home/controller/index.js"
    ],
    "names": [
        "indexAction",
        "model",
        "getOptions",
        "frontPage",
        "get",
        "action",
        "opensearchAction",
        "http",
        "type",
        "end",
        "options",
        "title",
        "description",
        "site_url",
        "rssAction",
        "getPostRssList",
        "list",
        "assign",
        "Date",
        "toString",
        "display",
        "HOME_VIEW_PATH",
        "sitemapAction",
        "postModel",
        "postList",
        "getPostSitemapList",
        "installAction",
        "isGet",
        "firekylin",
        "isInstalled",
        "redirect",
        "fail",
        "errors",
        "think",
        "isEmpty",
        "data",
        "post",
        "dbInfo",
        "host",
        "db_host",
        "port",
        "db_port",
        "database",
        "db_name",
        "user",
        "db_account",
        "password",
        "db_password",
        "prefix",
        "db_table_prefix",
        "account",
        "username",
        "InstallService",
        "service",
        "instance",
        "ip",
        "message",
        "run",
        "catch",
        "err",
        "contributorAction",
        "hasOwnProperty",
        "push",
        "USER_CONTRIBUTOR",
        "status",
        "USER_DISABLED",
        "create_time",
        "datetime",
        "last_login_time",
        "create_ip",
        "last_login_ip",
        "where",
        "name",
        "email",
        "_logic",
        "thenAdd"
    ],
    "mappings": "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",
    "file": "../../../src/home/controller/index.js",
    "sourcesContent": [
        "'use strict';\n\nimport Base from './base';\n\n\nexport default class extends Base {\n  /**\n   * 首页如果设置了自定义首页则渲染对应页面\n   * @return {[type]} [description]\n   */\n  async indexAction() {\n    let {frontPage} = await this.model('options').getOptions();\n    if(frontPage) {\n      this.get('pathname', frontPage);\n      return this.action('post', 'page');\n    }\n\n    return this.action('post', 'list');\n  }\n\n  /**\n   * 输出opensearch\n   */\n  opensearchAction() {\n    this.http.type('text/xml');\n\n    return this.end(`<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<OpenSearchDescription xmlns=\"http://a9.com/-/spec/opensearch/1.1/\">\n    <ShortName>${this.options.title}</ShortName>\n    <Description>${this.options.description}</Description>\n    <Url type=\"text/html\" template=\"${this.options.site_url}/search.html?s={searchTerms}\" />\n</OpenSearchDescription>`);\n  }\n\n  /**\n   * rss\n   * @return {[type]} [description]\n   */\n  async rssAction() {\n    let model = this.model('post');\n    let list = await model.getPostRssList();\n    this.assign('list', list);\n    this.assign('currentTime', (new Date()).toString());\n\n    this.type('text/xml');\n    return super.display(this.HOME_VIEW_PATH + 'rss.xml');\n  }\n\n  /**\n   * sitemap action\n   * @return {[type]} [description]\n   */\n  async sitemapAction() {\n    let postModel = this.model('post');\n    let postList = postModel.getPostSitemapList();\n    this.assign('postList', postList);\n\n    this.type('text/xml');\n    return this.display(this.HOME_VIEW_PATH + 'sitemap.xml');\n  }\n  /**\n   * install\n   * @return {[type]} [description]\n   */\n  async installAction() {\n    if(this.isGet()) {\n      if(firekylin.isInstalled) {\n        return this.redirect('/');\n      }\n      return this.display();\n    }\n    if(firekylin.isInstalled) {\n      return this.fail('SYSTERM_INSTALLED');\n    }\n\n    let errors = this.assign('errors');\n    if(!think.isEmpty(errors)) {\n      this.assign('message', errors[Object.keys(errors)[0]]);\n      return this.display();\n    }\n\n    let data = this.post();\n    let dbInfo = {\n      host: data.db_host,\n      port: data.db_port,\n      database: data.db_name,\n      user: data.db_account,\n      password: data.db_password,\n      prefix: data.db_table_prefix\n    }\n    let account = {\n      username: data.username,\n      password: data.password\n    }\n    let InstallService = this.service('install');\n    let instance = new InstallService(dbInfo, account, this.ip());\n    let message = 'success';\n    await instance.run().catch(err => {\n      message = err;\n    });\n    this.assign('message', message);\n    this.assign('data', data);\n    this.display();\n  }\n  /**\n   * 申请成为投稿者\n   * @return {[type]} [description]\n   */\n  async contributorAction() {\n    if(!this.options.hasOwnProperty('push') || +this.options.push === 0) {\n      return this.fail('PUSH_CLOSED');\n    }\n    if(this.isGet()) {\n      return this.display();\n    }\n\n    let user = this.post();\n    user.type = firekylin.USER_CONTRIBUTOR;\n    user.status = firekylin.USER_DISABLED;\n    user.create_time = think.datetime();\n    user.last_login_time = user.create_time;\n    user.create_ip = this.ip();\n    user.last_login_ip = this.ip();\n\n    await this.model('user').where({name: user.name, email: user.email, _logic: 'OR'}).thenAdd(user);\n    this.assign('message', 'success');\n    this.display();\n  }\n}\n"
    ]
}